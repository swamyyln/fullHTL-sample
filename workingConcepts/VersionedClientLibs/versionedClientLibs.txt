Versioned clientlibs uses Sling Rewriter to rewrite the client libraries generated by aem and append a unique MD5 value at end of the client library url.

After modification to client library, a new MD5 value is generated and appended to client library url this allows it to recache at client side. 

For example:- 

Normal AEM Client Library URL:- http://localhost:4502/etc.clientlibs/weretail/clientlibs/clientlib-base.js

Versioned Client Library URL:- http://localhost:4502/etc.clientlibs/weretail/clientlibs/clientlib-base.f2e70583096c942b4b71351437bce842.js

Whenever there is a change in the client libs it will create a new version of the client libs,
but the problem is the pages which are already cached in the dispatcher before a new version of the clientlibs still refer the previous version.
We need to clear the dispatcher cache whenever there is a change in client libs
----------------------

Normal ClientLibs :

All css in to single file
All js files in to single file

These concatenated single files will be cached and kept for smaller TTL.
But what if we modify the our custom css/js files,end user will keep on viewing the old inconsistent data.

once the existing file expired as ttl is small,again new clientLibs are fetched and changes will reflect but at the cost of page load time.

Versioned ClientLibs:

Please find the steps followed to implement versioned client libs

 

Versioned Client Libraries

 

1)Create "/apps/thf/config/rewriter[sling:Folder]"

2)Create "/apps/thf/config/rewriter/versioned-clientlibs.xml" file and copy below

 

<?xml version="1.0" encoding="UTF-8"?>

<jcr:root xmlns:sling="http://sling.apache.org/jcr/sling/1.0" xmlns:jcr="http://www.jcp.org/jcr/1.0"

    jcr:primaryType="sling:Folder"

    contentTypes="[text/html]"

    enabled="{Boolean}true"

    generatorType="htmlparser"

    order="{Long}1"

    serializerType="htmlwriter"

    transformerTypes="[linkchecker,versioned-clientlibs]"/>

               

3) copy the default node from "/libs/cq/config/rewriter/default" to "/apps/thf/config/rewriter/default"

add value "versioned-clientlibs" to property "transformerTypes".

 

4)Enable MD5 hashing by check box in "com.adobe.acs.commons.rewriter.impl.VersionedClientlibsTransformerFactory"

 

5)Now to verify above configuration System/console/status/sling-rewriter

/apps/thf/config/rewriter/default should be present

 

*******RESTART THE AEM INSTANCE TO SEE ABOVE SLING-REWRITER CONFIGURATIONS*********

 

Dispatcher level changes:

 

Add below in /etc/httpd/conf/extra/ssl.conf

SetEnvIf Request_URI "(\.min)?\.[a-f0-9]+\.js" long_expires=true

SetEnvIf Request_URI "(\.min)?\.[a-f0-9]+\.css" long_expires=true

Header set Cache-Control max-age=2592000 env=long_expires

 

Browser level verfication

 

Check source TAB

/etc/clientlibs/addtocart.min.ACSHASHbbbaaaa53b6.js

 

Hash value is fixed for each change.

To validate this go to /etc/designs/thf/cilentlibs/components/addtocart/js/source/addtocart.js

add an alert(ideally modify js file)

 

hash value will change only after removal of dispatcher cache.

 

Check network tab àjs tab àand filter individual component js file to see latest HASH value

 

Thanks,

Lakshminarayana Yeluri.

--------------------------------------------------------------
Need to check page load time before and after in SIT.

Need to test in IE and Mozilla browsers.

 

Note:

1)Every time when there is a change in individual JS/CSS a new  hash value will be generated and will be cached in dispatcher.(Before every deployment we need to clear cache folder )

 

2)For Example based on js/css content hash value will be generated


3)when there is hot fix(related to js/css) deployed ,changes should be reflected immediately without browser/dispatcher cache removal.

 

Observation:

Js/css is loading from browser( memory-cache) ,not from(disk-cache)




